<!DOCTYPE html>
<html xmlns:th="http://www/thymeleaf.org">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>主页管理</title>
		<link rel="stylesheet" th:href="@{/css/fontawesome.min.css}">
		<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
		<link rel="stylesheet" th:href="@{/css/templatemo-style.css}">
		<style>
			.box .status {
				margin-left: 15px;
			}
			.box .sum {
				margin-left: 5px;
			}
			.box .time {
				margin-left: 15px;
			}
			.content {
				margin: 10px;
				color: white;
				padding: 10px 20px 10px 10px;
			}
			
			.dingdanhao {
				margin-left: 5px;
			}
			
			.box {
				width: 100%;
				padding: 0px 25px;
				margin: 10px;
			}
			
			.box .dingdanhead {
				margin-bottom: 10px;
				margin-top: 10px;
				height: 40px;
				padding: 0px 15px;
				border: 1px solid rgb(225,225,225);
			}
			
			.step {
				margin: 4px 5px 0px 0px;
				display: inline-block;
				border: 1px solid rgb(227, 227, 227);
				background-color: rgba(242, 242, 242, 0.2);
				border-radius: 50%;
				height: 30px;
				line-height: 30px;
				text-align: center;
				width: 30px;
			}
			
			.box .dingdanhead h4 a {
				color: white;
			}
			
			.box .dingdanhead:hover {
				background-color:#34CE57;
			}
			
			.box .dingdanhead h4 {
				height: 100%;
				line-height: 100%;
				color: white;
				font-size: 16px;
				margin-bottom: 0px;
			}
			
			#shuxing .form-group {
				padding-bottom: 10px;
			}
			
			.form-group p {
				color: white;
				margin-right: 10px;
			}
			
			.form-group [type='radio']+span {
				color: white;
			}
			
			.tm-block {
				padding: 40px;
				width: 975px;
				-webkit-box-shadow: 1px 1px 5px 0 #455c71;
				-moz-box-shadow: 1px 1px 5px 0 #455c71;
				box-shadow: 1px 1px 5px 0 #455c71;
				height: 100%;
			}
			.panel-collapse in {
				display: block;
			}
			.collapsed {
				display: none;
			}
			.team{
				color: #99ff99;
				margin-left: 10px;
			}
			#xz_ry .modal-body span{
				display: inline-block;
				width: 150px;
				text-align: center;
			}
		</style>
	</head>
	<body id="reportsPage">
		<div class="" id="home">
			<div class="container">
				<div id="xz_ry" >
				<div class="modal-dialog" style="max-width: 90%;text-align: center;">
				<div class="modal-content" style="background: #435c70;color: white;">
					<div class="modal-header">
						<h5 class="modal-title" id="myModalLabel">新增订单</h5>
					</div>
					<div class="modal-body" style="text-align: center;">
							<div>
								<span style="margin-left: 50px;margin-bottom:30px" name="ckprojectproduct">选择活动</span>
								<input type="radio" name="productOrProject" xz="1" style="width: 15px;height: 15px;" />
								<span style="margin-left: 70px;" name="ckprojectproduct">选择项目</span>
								<input type="radio" name="productOrProject" xz="2" style="width: 15px;height: 15px; " />
								<div name="productHidden" style="display: none;">
								<table class="table table-hover tm-table-small tm-product-table" style="width:80%;margin:30px auto;">
					                <thead>
					                  <tr>
					                    <th scope="col">&nbsp;</th>
					                    <th scope="col">活动名称</th>
					                    
					                  </tr>
					                </thead>
					                <tbody class="proucttable" id="product_tbody">
					                  
					        		</tbody>
					             </table>									
								</div>
								<div name="projectHidden" style="display: none;">
									<table class="table table-hover tm-table-small tm-product-table" id="project-table" style="width:80%;margin: 30px auto;">
					               
					                  <tr>
					                    <th scope="col">&nbsp;</th>
					                    <th scope="col">项目名称</th>
					                     <th scope="col">状态</th>
					                  </tr>
					                  
					              </table>
								</div>								
							</div>
							
							
							
							<div id="hide_ry" style="display: none;margin-top: 30px;">
								<div style="margin-top: 30px;">
								<span>请输入身份证号</span>
								<input  class="input-group-sm" style="width: 30%;" /><br>
								<br>
								
								
								</div>
							</div>
					</div>
					
					<div id="hide_cc" style="display: none;margin-top: 30px">
								<h5>活动项目</h5>
								<table class="table table-hover tm-table-small tm-product-table" id="project_table"  style="margin-top: 20px;">
					                <thead>
					                  <tr>
					                  	<th>
					                  		项目名称
					                  	</th>
					                  	<th>状态</th>	
					                  	<th></th>
					                  	<th></th>
					                  </tr>	
					                 </thead>
					               	<tbody class="pruduct_project_tbody">
					               		
					               	</tbody>
					               
				             	</table>
							</div>
							
					<div id="xin_paiban" style="display: none;">
						<button class="btn btn-primary" name="xin_paiban_button" style="margin-top: 20px;margin-left: 25px;border-radius: 30px;">
									排班
						</button>
					</div>
					
							
					<!-- <div class="hide_jd" style="margin-top: 50px;display: none;display: none;">
					<div class="col-lg-12">
							<h4>安排人员</h4>
							<select class="form-control-sm" style="width: 186px;">
								<option>
									教练
								</option>
								<option>
									助理
								</option>
							</select>
							<input type="button" id="" style="border-radius: 30px 30px 30px 30px;width: 100px;margin-left: 100px;" class="btn-primary" value="查询" />
							<table class="table" style="margin-top: 20px;">
								<thead>
									<tr>
										<th>人员名称</th>
										<th></th>
									</tr>
								</thead>
								<tbody id="look_Staff_tbody">
									
								</tbody>
							</table>
						</div>
					</div>
							
					<div class="hide_jd" style="margin-top: 50px;display: none;display: none;">
						<div class="col-lg-12">
							<h4>选择基地</h4>
							<table class="table" style="margin-top: 20px;">
								<thead>
									<tr>
										<th>基地名称</th>
										<th></th>
									</tr>
								</thead>
								<tbody id="project_jd_table">
									
								</tbody>
							</table>
						</div>
						
					</div> -->

					<div id="hide_project_time" style="display: none;margin-top: 10px;">
						
					</div>
					
					<div style="margin: 30px auto;" hidden="hidden" class="infoss">
								<span style="margin-left: 50px;">团队</span>
								<input type="radio" name="dd_radio" data="dd_radio" class="" style="width: 15px;height: 15px;" />
								<span style="margin-left: 70px;">个人</span>
								<input type="radio" name="dd_radio" data="gr_radio" style="width: 15px;height: 15px;" />
							</div>
							<div id="hide_dd" style="display: none;">
								<span style="margin-top: 20px;">请输入身份证号</span>
								<input type="text" name="card" value="430424200106031438" style="margin-left: 20px;height: 30px;margin-top: 20px;width: 30%;" />
								<input type="button" id="queryByFzr" style="border-radius: 30px 30px 30px 30px;width: 100px;margin-left: 100px;" class="btn-primary" value="查询" />
								<br>
					</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<button type="button" name="order_submit" class="btn btn-primary">提交</button>
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
				</div>
			</div>
		</div>
		<script th:src="@{/js/jquery-3.3.1.min.js}"></script>
		<script th:src="@{/js/moment.min.js}"></script>
		<script th:src="@{/js/Chart.min.js}"></script>
		<script th:src="@{/js/bootstrap.min.js}"></script>
    	<script th:src="@{/jquery-ui-datepicker/jquery-ui.min.js}"></script>
    	<script th:src="@{/js/vue.js}"></script>
		
		<script>
      $(function() {
      	var pid;
      	var ry_dt;
      	var jd_name;
      	var jd_id;
        $("#expire_date").datepicker({
          defaultDate: "10/22/2020"
        });
         $("[type=submit]").click(function(){
			location.href="orders.html";
		}) 
		 $("#tj").click(function(){
			var new_sj=$(this).parents("tr").clone(true);
			new_sj.find("[type=text]").val("");
			$("#ry_tb_body").append(new_sj);
		}) 
		$("#yc").click(function(){
			var tr_length=$(".ry_tb_body_tr").length;
			if(tr_length==1){
				alert("已经是最后一个了,不能删除");
			}else{
				$(this).parents("tr").remove();
			}
		});
         
         /*显示团队*/
		$("[data=dd_radio]").click(function(){
			if(true){
				$("#hide_dd").css("display","block");
			}
			$("#hide_ry").css("display","none");
		});
         
         /*显示个人*/
		$("[data=gr_radio]").click(function(){
			if(true){
				$("#hide_ry").css("display","block");
			}
			$("#hide_dd").css("display","none");
		});
		
		
		
		/* $(".show_project_time").click(function(){
			
			
		}) */
		
		/*显示个人与团队*/
		$("[name=ap_user]").click(function(){
			$(".infoss").removeAttr("hidden");
		})
		
		
		
		var xzid;
		
		/*查询活动与项目如果xzid为1则查询活动为2则查询项目*/
		$("[name=productOrProject]").click(function(){
			
			xzid=$(this).attr("xz");
			
			/*活动*/
			if(xzid==1){
				$("[name=productHidden]").css('display','block');
				$("[name=projectHidden]").css('display','none');
				var product_name=$("[name=product_name]").val();
				$.ajax({
					url:"query_Product",
					type:"post",
					dataType:"json",
					success:function(result){
						
						$("#product_tbody").html(""); 
						$.each(result,function(i,obj){
							var dt=$("<tr>"+
				                    "<th scope='row'><input pid='"+obj.id+"' type='radio' name='look_product'/></th>"+
				                    "<td class='tm-product-name'>"+obj.pname+"</td>"+
				                  "</tr>"+
				                  "<tr hidden='hidden'>"+
				                  "</tr>");
							$("#product_tbody").append(dt);
						})
					}
				});
				/*项目*/
			}else if(xzid==2){
				$("[name=projectHidden]").css('display','block');
				$("[name=productHidden]").css('display','none');
				var project_name=$("[name=project_name]").val();
				$.ajax({
					url:"query_Project",
					type:"post",
					dataType:"json",
					success:function(result){
						var dt;
						$("#project-table").html(""); 
						$.each(result,function(i,obj){
							if(obj.pstatus==1){
								dt=$("<tbody class='one_project_tbody'>"+
										" <tr>"+
											"<td scope='row'><input type='checkbox' pid='"+obj.id+"' class='show_jd'/></td>"+
					                    	"<td class='tm-product-name'>"+obj.pname+"</td>"+
					                    	"<td>开放</td>"+
					                    	"<td></td>"+
					                    "</tr>"+
					                    "</tbody>")
							}else if(obj.pstatus==2){
								dt=$("<tbody class='one_project_tbody'>"+
										" <tr>"+
											"<td scope='row'><input type='checkbox' pid='"+obj.id+"' class='show_jd'/></td>"+
					                    	"<td class='tm-product-name'>"+obj.pname+"</td>"+
					                    	"<td>维修</td>"+
					                    	"<td></td>"+
					                    "</tr>"+
					                    "</tbody>")
							}else if(obj.pstatus==3){
								dt=$("<tbody class='one_project_tbody'>"+
										" <tr>"+
											"<td scope='row'><input type='checkbox' pid='"+obj.id+"' class='show_jd'/></td>"+
					                    	"<td class='tm-product-name'>"+obj.pname+"</td>"+
					                    	"<td>检测</td>"+
					                    	"<td></td>"+
					                    "</tr>"+
					                    "</tbody>")
							}
							
					                   $("#project-table").append(dt);
						})
					}
				});
			}
		})
		
		/*活动查询项目*/
		$("#product_tbody").on("click","[name=look_product]",function(){
			
			if(xzid==2){
				$("#hide_cc").css("display","block");
			}else if(xzid==1){
				$("#hide_cc").css("display","block");
				var pid1=$(this).attr("pid");
				$.ajax({
					url:"/xjb_productController/queryByProdId?productId="+pid1,
					type:"post",
					dataType:"json",
					success:function(result){
						var product_project_dt;
						$(".pruduct_project_tbody").html("");
						$.each(result,function(i,obj){
							if(obj.pro.pstatus==1){
								product_project_dt=$("<tr id='each_project_tr'>"+
					                    "<td scope='col' iid="+obj.pro.id+">"+obj.pro.pname+"</td>"+
					                    "<td scope='col'>开放</td>"+
					                    "<td scope='col'>"+
					                    	"<input type='checkbox' pid='"+obj.pro.id+"' class='show_jd'>"+
					                    "</td>"+
					                     "<td></td>"+				                     
					                 "</tr>")
		                    }else if(obj.pro.pstatus==2){
		                    	product_project_dt=$("<tr id='each_project_tr'>"+
		                    			"<div id='project_div'>"+
					                    "<td scope='col'>"+obj.pro.pname+"</td>"+
					                    "<td scope='col'>维修</td>"+
					                    "<td scope='col'>"+
					                    	"<input type='checkbox' pid='"+obj.pro.id+"' class='show_jd'>"+
					                    "</td>"+
					                     "<td></td>"+
					                     "</div>"+
					                 "</tr>")
		                    }else if(obj.pro.pstatus==3){
		                    	product_project_dt=$("<tr id='each_project_tr'>"+
		                    			"<div id='project_div'>"+
					                    "<td scope='col'>"+obj.pro.pname+"</td>"+
					                    "<td scope='col'>检测</td>"+
					                    "<td scope='col'>"+
					                    	"<input type='checkbox' pid='"+obj.pro.id+"' class='show_jd'>"+
					                    "</td>"+
					                     "<td></td>"+
					                     "</div>"+
					                 "</tr>")
		                    }
							$(".pruduct_project_tbody").append(product_project_dt);
						})
					}
				});
			}
			
		})
		
		
		
		/*选择活动点击项目查询基地与工作人员*/
		$("#project_table").on("click",".show_jd",function(){
				$("#xin_paiban").css("display","block");
				pid=$(this).attr("pid");
		}) 
		
		$("[name=xin_paiban_button]").click(function(){
			if(confirm("您以选完项目了吗")){
				$("#hide_project_time").css("display","block");
				var lis=[];
				var timelist=[];
				$(".show_jd").each(function(){
					if(this.checked){
						var o={};
						o.iid=$(this).attr("pid");
						o.typeid=1;
						lis.push(o);
					}
				})
				var list=JSON.stringify(lis);
				var ordersssss = new Array();
				
				$.ajax({
					url:"queryWork",
					data:JSON.stringify(lis),
					type:"post",
					dataType:"json",
					processData:false, 
	 				contentType:"application/json;charset=UTF-8",
					success:function(data){
						
					}
				})
			}else{
				$(".show_jd").each(function(){
					$(this).prop("checked",false);
				})
			}
		});
		
		/*单机基地显示排班时间*/
		$("body").on("click","[name=xin_showjd]",function(){
			if(this.checked){
				$(this).parent("h5").next("h5").find(".xinshowjd_div").css("display","block");
			}else{
				$(this).parent("h5").next("h5").find(".xinshowjd_div").css("display","none");
			}
			
		})
		
		/*查询安排人员*/
		$("body").on("click",".apry_a",function(){
			var a=$(this).attr("uid");
			
			var s=JSON.stringify(a);
			console.log(s);
		})
		
		
		/*点击工作人员追加到项目下面*/
		/* $("#look_Staff_tbody").on("click","[name=ck_ry]",function(){
			
			if (this.checked) {
				var ry_name=$(this).parents("tr").find("td:eq(0)").html();
				var ry_id=$(this).parents("tr").find("td:eq(0)").attr("staid");
				
				if(document.querySelector("tr[pid='"+pid+"x']")==null){
					ry_dt=$("<tr name='order_ry_tr'></tr>");
					ry_dt.attr("pid",pid+"x");
					ry_dt.append("<td ry_id='"+ry_id+"'>"+ry_name+"</td>");
					$("[pid='"+pid+"']").parents("tr").after(ry_dt);
				}else{
					ry_dt=$("[pid='"+pid+"x']");
					var td=$("<td ry_id='"+ry_id+"'>"+ry_name+"</td>");
					ry_dt.append(td);
				}
			}else{
				
			}
			
		}) */
		
		
	
		
		/*点击排班复选框追加到项目下面*/
		 $("body").on("click","[name=lr_time_ck]",function(){
			/*  alert(123); */
			var jd_name=$(this).parents(".checkjdid_div").find("h5:eq(0)").html();
			var jd_id=$(this).parents(".checkjdid_div").find("h5:eq(0)").attr("jdid");
			var tid=$(this).parents("tr").attr("tid");
			var thead=$("[pid='"+pid+"']").parents("thead"); 
			var jia_tr=$(thead).find("tr [tid='"+tid+"']").html();
			var zhen_tr=$(thead).find("tr[tid='"+tid+"']");
			var rs=$(this).parents("tr").find("td:eq(3)").children("input").val();
			
			$($(this).parents("tr").find("td:eq(3)").children("input")).change(function(){
				alert($(this).val());
			})
			
			var kw=$(this).parents("tr").find("td:eq(2)").html();
			var kw1=kw-rs;
			/* var index=0;
			$("[name=ck_ry]").each(function(){
				if(this.checked){
					index=1;
				}
			})
			if(index==0){
				alert("请先选择工作人员");
			} */
			
			
				if($(this).parent("td").prev("td").find("input").val()==""){
					alert("您还没有输入人数");
					this.checked=false;
				}else if(jia_tr==null){
					if(kw1<0){
						alert("人数不能大于空位");
						this.checked=false;
					}else{
						$("[name=lr_time_ck]").each(function(i,obj){
							if(obj.checked){
								$(this).parents("tr").find("td:eq(2)").html(kw1);
								var dt=$("<tr tid='"+tid+"' name='order_time_tr'>"+
										"<td style='color: orange;' order_pid='"+pid+"' jd_id='"+jd_id+"'>"+jd_name+"</td>"+ 
					                	"<td>"+$(obj).parents("tr").find("td:eq(0)").html()+"</td>"+
					                	"<td>"+$(obj).parents("tr").find("td:eq(1)").html()+"</td>"+
					                	"<td>"+kw1+"</td>"+
					                	"<td>"+rs+"</td>"+
					                "</tr>");
								alert(pid)
								alert($("[pid='"+pid+"']").parents("tr").html())
								$("[pid='"+pid+"']").parents("tr").after(dt);
					       		/* if(document.querySelector("[pid='"+pid+"']")==null){
									var ry_dt1=$("<tr></tr>");
									ry_dt1.attr("pid",pid);
									$("[pid='"+pid+"']").after(ry_dt1);
									$(ry_dt1).after(dt);
								}else{
									
									var ry_dt1=$("[pid='"+pid+"y']");
									$(ry_dt1).after(dt);
								}
					       		return;  */
					       	}
						})
						
					}
				}
			
			
		}) 
		
			
		/* 
		$("#project_tbody").on("click","[name=look_project]",function(){
			$(".infoss").removeAttr("hidden");
		}) */
		
		$(".show_pb").click(function(){
			
			
		})
		
		/*新增订单*/
		$("[name=order_submit]").click(function(){
			/*订单从表*/
			var orderson=[];
			var typeid;
			var orderwork=[];
			var opklist=[];
			var wulist=[];
			var iid;
			if(xzid==1){
				$("[name=look_product]").each(function(){
					if(this.checked){
						var odr = {};
						typeid=5;
						iid=$(this).attr("pid")
						odr.typeid = typeid;
						odr.iid = iid;
						orderson.push(odr);
					}
				})
				var bl={};
				$(".pruduct_project_tbody").each(function(){
					/*订单项目排班表*/
					var order_time_tr=$(this).find("[name=order_time_tr]");
					$.each(order_time_tr,function(){
						wulist=[];
						$.each($(this).prev().prev().find("td"),function(){
							var wuser={};
							/*排班安排人员id*/
							wuser.productstaffid=$(this).attr("ry_id");
							wulist.push(wuser);
						})
						var ordertime={};
						/*订单项目id*/
						ordertime.iid=$(this).find("td:eq(0)").attr("order_pid");
						/*排班开始时间*/
						ordertime.starttime=$(this).find("td:eq(1)").text();
						/*排班结束时间*/
						ordertime.endtime=$(this).find("td:eq(2)").text();
						/*基地id*/
						ordertime.name1=$(this).find("td:eq(0)").attr("jd_id");
						ordertime.list=wulist;
						opklist.push(ordertime);
				})
				/* if(xzid==2){
					
				} */
				orderwork.push({list:opklist});
			})
			}else if(xzid==2){
				$(".show_jd").each(function(){
					if(this.checked){
						var odr1={};
						typeid=1;
						iid=$(this).parents("tr").find("td:eq(0)").attr("iid");
						odr1.typeid = typeid;
						odr1.iid = iid;
						orderson.push(odr1);
					}
				})
				$(".one_project_tbody").each(function(){
					/*订单项目排班表*/
					var order_time_tr=$(this).find("[name=order_time_tr]");
					$.each(order_time_tr,function(){
						wulist=[];
						$.each($(this).prev().prev().find("td"),function(){
							var wuser={};
							/*排班安排人员id*/
							wuser.productstaffid=$(this).attr("ry_id");
							wulist.push(wuser);
						})
						var ordertime={};
						/*订单项目id*/
						ordertime.iid=$(this).find("td:eq(0)").attr("order_pid");
						/*排班开始时间*/
						ordertime.starttime=$(this).find("td:eq(1)").text();
						/*排班结束时间*/
						ordertime.endtime=$(this).find("td:eq(2)").text();
						/*基地id*/
						ordertime.name1=$(this).find("td:eq(0)").attr("jd_id");
						ordertime.list=wulist;
						opklist.push(ordertime);
				})
				orderwork.push({list:opklist});
				})
			}
			
			var o={};
			o.order_work=orderwork;
			o.order_son=orderson;
			o=JSON.stringify(o);
			console.log(o);
			$.ajax({
				url:"insert",
				type:"post",
				data:o,
				processData:false, 
 				contentType:"application/json;charset=UTF-8",
 				dataType:"text",
				success:function(result){
					alert("新增成功")
				}
			}); 
		})
      })
      	var pd=1;
		var timelist=[];
		var etimes=new Date();
		var orderson1;
		var hd = 0; 
      function DataXm(data,number1) {
			pd=1;
			timelist=[];
			hd=0;
			document.querySelector(".xmpb").innerHTML="";
			var etime1 = Date.parse(new Date("2019-5-21 15:00:00"));
			for(var i = 0; i < data.length; i++) {
				var be1 = 0;
				if(data[i].ix != null) {
					if(data[i].ix.length == undefined) {
						for(var h = 0; h < data[i].ix.areas.length; h++) {
							var indexss=0;
							$.each(data[i].ix.areas[h].worktimes, function(index, item) {
								$.each(item, function(index1, item1) {
									var time3 = Date.parse(new Date(item1.startTime));
									var pro = {};
										if(hd == 0 && timelist[hd] == null && time3 > etime1 && number1 < data[i].ix.galleryful) {
											pro.time = item1.startTime;
											pro.area = data[i].ix.areas[h].aname;
											pro.id = data[i].ix.areas[h].aname;
											pro.pname = data[i].ix.pname;
											pro.etime = item1.endTime;
											timelist[hd] = pro;
											be1++;
											indexss=1;
										} else
										if(timelist[hd] == null && hd != 0 && timelist[hd - 1] != null && item1.startTime > timelist[hd - 1].etime && time3 > etime1 && number1 < data[i].ix.galleryful) {
											pro.time = item1.startTime;
											pro.area = data[i].ix.areas[h].aname;
											pro.pname = data[i].ix.pname;
											pro.etime = item1.endTime;
											timelist[hd] = pro;
											be1++;
											indexss=1;
										} else
											if(timelist[hd] != null && timelist[hd].time > item1.startTime&&(timelist[hd - 1]!=null && timelist[hd - 1].etime < item1.startTime||hd==0)&& time3 > etime1 && number1 < data[i].ix.galleryful) {
											var pro = {};
											pro.time = item1.startTime;
											pro.area = data[i].ix.areas[h].aname;
											pro.pname = data[i].ix.pname;
											pro.etime = item1.endTime;
											timelist[hd] = pro;
											be1++;
											indexss=1;
										}
								})
							})
							
							if(indexss==0){
								pd=0;
							}
							if(be1 != 0) {
								break;
								be1 = 0;
							}
						}
						hd++;
					}else {
						for(var j = 0; j < data[i].ix.length; j++) {
							var be = 0;
							for(var h = 0; h < data[i].ix[j].areas.length; h++) {
								var indexss=0
								$.each(data[i].ix[j].areas[h].worktimes, function(index, item) {
									$.each(item, function(index1, item1) {
										var time3 = Date.parse(new Date(item1.startTime));
										var pro = {};
												if(hd == 0 && timelist[hd] == null && time3 > etime1 && number1 < data[i].ix[j].galleryful) {
													pro.time = item1.startTime;
													pro.area = data[i].ix[j].areas[h].aname;
													pro.pname = data[i].ix[j].pname;
													pro.etime = item1.endTime;
													timelist[hd] = pro;
													be++;
													indexss=1;
												} else
												if(timelist[hd] == null && hd != 0 &&timelist[hd - 1]!=null&& item1.startTime > timelist[hd - 1].etime && time3 > etime1 && number1 < data[i].ix[j].galleryful) {
													pro.time = item1.startTime;
													pro.area = data[i].ix[j].areas[h].aname;
													pro.pname = data[i].ix[j].pname;
													pro.etime = item1.endTime;
													timelist[hd] = pro;
													be++;
													indexss=1;
												} else
													if(timelist[hd] != null && timelist[hd].time > item1.startTime&&(timelist[hd - 1]!=null && timelist[hd - 1].etime < item1.startTime||hd==0)&& time3 > etime1 && number1 < data[i].ix[j].galleryful) {
														var pro = {};
														pro.time = item1.startTime;
														pro.area = data[i].ix[j].areas[h].aname;
														pro.pname = data[i].ix[j].pname;
														pro.etime = item1.endTime;
														timelist[hd] = pro;
														be++;
														indexss=1;
														console.log(timelist[hd].time>item1.startTime)
													}
									})
								})
								if(indexss==0){
									pd=0;
								}		
								if(be != 0) {
									break;
									be = 0;
								}
							}
							hd++;
						}
					}
				}
			}
		}
      
      	
		function Xm(number1,startTime,ix){
				console.log(ix);
				if(ix%3==0&&ix!=0){
					j++;
				}
				var startTime1=startTime.getFullYear()+"-"+(startTime.getMonth()+1)+"-"+(startTime.getDate()+j)+" "+"7:30:00";
				var endTime1=startTime.getFullYear()+"-"+(startTime.getMonth()+1)+"-"+(startTime.getDate()+ix)+" "+"7:30:00";
				ix++;
				$.ajax({
						url:"http://192.168.43.139:8080/shopcartshh/query",
				  		data:{"orderson":orderson1,"startTime":startTime1,"endTime":endTime1},
				  		dataType:'json',//服务器返回json格式数据
				  		type:'post',//HTTP请求类型
				  		timeout:10000,//超时时间设置为10秒；
				  		success:function(data){
					  			DataXm(data,number1);
					  			if(pd==1){
					  				for (var m=0;m<timelist.length;m++) {
					  						var li=document.querySelector(".xmpb");
					  						var times=new Date(timelist[m].time);
					  						var time=(times.getMonth()+1)+"-"+times.getDate()+" "+times.getHours()+":"+times.getMinutes()+":"+times.getSeconds();
					  						var etimes=new Date(timelist[m].etime);
					  						var etime=(etimes.getMonth()+1)+"-"+etimes.getDate()+" "+etimes.getHours()+":"+etimes.getMinutes()+":"+etimes.getSeconds();
						  					XmPb(li,timelist[m].pname,timelist[m].area,time,etime)
					  				}
	  									document.querySelector(".time").style.display="block";
									    //Date.parse() 解析一个日期时间字符串，并返回1970/1/1 午夜距离该日期时间的毫秒数
									    var time1 = Date.parse(new Date(timelist[0].time));
									    var time2 = Date.parse(new Date(timelist[timelist.length-1].time));
									    var nDays = Math.abs(parseInt((time2 - time1)/1000/3600 / 24));
								}else{
										Xm(number1,startTime,ix);
								};
						}
					});
		}

    </script>

	</body>

</html>